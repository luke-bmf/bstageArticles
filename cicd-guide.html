<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CI/CD 가이드</title>
  <link href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css" rel="stylesheet">
  <style>
    * { box-sizing: border-box; }
    html { overflow-x: hidden; }
    body {
      font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, sans-serif;
      max-width: 880px;
      margin: 0 auto;
      padding: 2rem 80px;
      position: relative;
    }
    img { max-width: 100%; height: auto; }
    table {
      width: 100%;
      max-width: 100%;
      border-collapse: collapse;
      margin: 1rem 0;
    }
    th, td {
      border: 1px solid #ddd;
      padding: 10px 14px;
      text-align: left;
      word-break: break-word;
      overflow-wrap: break-word;
      vertical-align: top;
    }
    th { background: #f5f5f5; font-weight: 600; }
    tr:nth-child(even) { background: #fafafa; }
    blockquote {
      color: #6b7280;
      border-left: 3px solid #9ca3af;
      padding-left: 16px;
      margin: 1rem 0;
    }
    blockquote p { margin: 0; }
    pre, code { max-width: 100%; overflow-x: auto; background: #f5f5f5; padding: 2px 6px; border-radius: 4px; }
    .article-hero {
      position: relative;
      width: 100%;
      min-width: 0;
      max-width: 700px;
      aspect-ratio: 7 / 4;
      overflow: hidden;
      border-radius: 12px;
      margin-bottom: 48px;
    }
    .article-hero img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    @media screen and (max-width: 500px) {
      body { padding: 1rem 16px; }
    }
  </style>
</head>
<body>
  <h1>CI/CD 가이드</h1>
  <blockquote>
    <p>템플릿 자동 배포 (CI/CD) 가이드 — 이 문서는 템플릿이 어떻게 자동으로 배포되는지 설명합니다.</p>
  </blockquote>

  <h2>핵심 개념</h2>
  <p>CI/CD는 파일을 수정하고 GitHub에 올리면 자동으로 서버에 반영되는 시스템입니다.</p>
  <p><strong>템플릿 파일 수정 → GitHub에 업로드 → 자동으로 서버에 반영</strong></p>
  <p>직접 서버에 접속하거나 복잡한 작업을 할 필요 없이, GitHub에 파일만 올리면 나머지는 모두 자동으로 처리됩니다.</p>

  <h2>3가지 환경 설명</h2>
  <p>템플릿은 3가지 환경에 배포됩니다. 각 환경은 서로 다른 목적을 가지고 있습니다.</p>
  <table>
    <thead>
      <tr>
        <th>환경</th>
        <th>용도</th>
        <th>배포 조건</th>
        <th>CDN 주소</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><strong>Dev</strong></td>
        <td>개발 및 테스트용</td>
        <td>main 브랜치에 push</td>
        <td><code>cdn-dev.static.astage.in</code></td>
      </tr>
      <tr>
        <td><strong>QA</strong></td>
        <td>품질 테스트용</td>
        <td>main 브랜치에 push</td>
        <td><code>cdn-qa.static.astage.in</code></td>
      </tr>
      <tr>
        <td><strong>Real</strong></td>
        <td>실제 서비스용</td>
        <td>Tag 생성 시</td>
        <td><code>cdn.static.astage.in</code></td>
      </tr>
    </tbody>
  </table>

  <h3>각 환경의 역할</h3>
  <ul>
    <li><strong>Dev 환경</strong>: 개발 중인 템플릿을 테스트하는 공간입니다. 자유롭게 수정하고 확인할 수 있습니다.</li>
    <li><strong>QA 환경</strong>: 품질 검증을 위한 공간입니다. 실서비스 배포 전 최종 확인을 진행합니다.</li>
    <li><strong>Real 환경</strong>: 실제 사용자에게 보여지는 서비스 환경입니다. 신중하게 배포해야 합니다.</li>
  </ul>

  <h2>배포 방법</h2>

  <h3>1. Dev/QA 환경 배포 (테스트용)</h3>
  <p>main 브랜치에 push하면 자동으로 Dev와 QA 환경에 동시에 배포됩니다.</p>
  <table>
    <thead>
      <tr><th>작업 순서</th></tr>
    </thead>
    <tbody>
      <tr><td>1. 템플릿 파일을 수정합니다</td></tr>
      <tr><td>2. 변경사항을 commit 합니다</td></tr>
      <tr><td>3. main 브랜치에 push 합니다</td></tr>
      <tr><td>4. 약 1~2분 후 Dev/QA 환경에 반영됩니다</td></tr>
    </tbody>
  </table>
  <p><strong>파일 수정 → commit → push (main) → 1~2분 대기 → 반영 완료</strong></p>

  <h3>2. Real 환경 배포 (실서비스용)</h3>
  <p>GitHub에서 Tag를 생성하면 자동으로 Real 환경에 배포됩니다.</p>
  <table>
    <thead>
      <tr><th>작업 순서</th></tr>
    </thead>
    <tbody>
      <tr><td>1. Dev/QA 환경에서 충분히 테스트합니다</td></tr>
      <tr><td>2. GitHub에서 Tag를 생성합니다 (예: v1.0.0, v1.0.1 등)</td></tr>
      <tr><td>3. 약 1~2분 후 Real 환경에 반영됩니다</td></tr>
    </tbody>
  </table>
  <p><strong>Dev/QA 테스트 완료 → Tag 생성 → 1~2분 대기 → 실서비스 반영</strong></p>

  <h2>배포 대상 파일</h2>
  <p><code>data.json</code> 파일을 제외한 <code>public/</code> 폴더 안에 있는 파일들이 CDN에 업로드됩니다.</p>

  <h2>업로드 경로</h2>
  <table>
    <thead>
      <tr>
        <th>환경</th>
        <th>CDN 기본 경로</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>Dev</td>
        <td><code>https://cdn-dev.static.astage.in/3pp-templates/bmf/</code></td>
      </tr>
      <tr>
        <td>QA</td>
        <td><code>https://cdn-qa.static.astage.in/3pp-templates/bmf/</code></td>
      </tr>
      <tr>
        <td>Real</td>
        <td><code>https://cdn.static.astage.in/3pp-templates/bmf/</code></td>
      </tr>
    </tbody>
  </table>

  <h3>예시</h3>
  <table>
    <thead>
      <tr>
        <th>로컬 파일 경로</th>
        <th>Dev 환경 CDN 주소</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><code>public/liquid/home/template.liquid</code></td>
        <td><code>cdn-dev.static.astage.in/3pp-templates/bmf/liquid/home/template.liquid</code></td>
      </tr>
      <tr>
        <td><code>public/icons/badge_paid.png</code></td>
        <td><code>cdn-dev.static.astage.in/3pp-templates/bmf/icons/badge_paid.png</code></td>
      </tr>
      <tr>
        <td><code>public/images/banner/mobile_1.png</code></td>
        <td><code>cdn-dev.static.astage.in/3pp-templates/bmf/images/banner/mobile_1.png</code></td>
      </tr>
    </tbody>
  </table>
  <p>QA, Real 환경도 동일한 구조이며, CDN 도메인만 다릅니다.</p>

  <h2>배포 확인 방법</h2>
  <h3>GitHub Actions에서 확인</h3>
  <ol>
    <li>GitHub 저장소에 접속합니다</li>
    <li>상단 메뉴에서 "Actions" 탭을 클릭합니다</li>
    <li>배포 작업 목록을 확인합니다</li>
  </ol>
  <p>주소: <a href="https://github.com/partners-bmf/bstage-bmf-templates/actions" target="_blank" rel="noopener">https://github.com/partners-bmf/bstage-bmf-templates/actions</a></p>
  <table>
    <thead>
      <tr>
        <th>상태</th>
        <th>의미</th>
      </tr>
    </thead>
    <tbody>
      <tr><td>초록색</td><td>배포 성공</td></tr>
      <tr><td>빨간색</td><td>배포 실패</td></tr>
      <tr><td>노란색</td><td>배포 진행</td></tr>
    </tbody>
  </table>

  <h2>배포 이후 스테이지와 통합</h2>
  <p>CDN에 업로드된 템플릿은 다음과 같은 과정을 거쳐 사용자에게 보여집니다.</p>
  <ol>
    <li>사용자가 커스텀 페이지를 허용하는 스테이지에 접근합니다</li>
    <li>서버가 CDN에서 해당 스테이지의 커스텀 템플릿(.liquid 파일)을 불러옵니다</li>
    <li>API를 통해 템플릿에 바인딩할 데이터(스테이지 정보, 콘텐츠 등)를 가져옵니다</li>
    <li>템플릿에 데이터를 바인딩하여 완성된 HTML을 생성합니다</li>
    <li>브라우저에 렌더링하여 사용자에게 보여줍니다</li>
  </ol>
</body>
</html>
